{% extends "base/dashboard.html" %}
{% load i18n static %}

{% block app_title %}{% trans 'User - Detail' %}{% endblock %}
{% block dashboard_css %}
  <link href="{% static 'plugins/jstree/style.min.css' %}" rel="stylesheet">
{% endblock %}

{% block modals %}

  <div class="modal fade" id="userDetailUpdateModal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
      {% include 'identity/management/forms/user_update_form.html' with form=user_update_form%}
    </div>
  </div>

  <div class="modal fade" id="userObjectPermsModal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">{% trans 'Update user object permissions' %}</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="row">
            <div class="col-12">
              {# render jstree #}
              <div id="userObjectPermsTree">
                <div id="resourceAccordion" role="tablist" aria-multiselectable="true">
                  <div class="card">
                    <div class="card-header" role="tab" id="headingOne">
                      <h5 class="mb-0 mt-0">
                        <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne" class="text-dark" aria-expanded="true" aria-controls="collapseOne">
                          {% trans 'storage' %}
                        </a>
                      </h5>
                    </div>

                    <div id="collapseOne" class="collapse show" role="tabpanel" aria-labelledby="headingOne" style="">
                      <div class="card-body">
                        Anim pariatur cliche reprehenderit, enim eiusmod high life accusamus terry richardson ad squid. 3 wolf moon officia aute, non cupidatat skateboard dolor brunch. Food truck quinoa nesciunt laborum eiusmod. Brunch 3 wolf moon tempor, sunt aliqua put a bird on it squid single-origin coffee nulla assumenda shoreditch et. Nihil anim keffiyeh helvetica, craft beer labore wes anderson cred nesciunt sapiente ea proident. Ad vegan excepteur butcher vice lomo. Leggings occaecat craft beer farm-to-table, raw denim aesthetic synth nesciunt you probably haven't heard of them accusamus labore sustainable VHS.
                      </div>
                    </div>
                  </div>
                  <div class="card">
                    <div class="card-header" role="tab" id="headingTwo">
                      <h5 class="mb-0 mt-0">
                        <a class="collapsed text-dark" data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                          {% trans 'compute' %}
                        </a>
                      </h5>
                    </div>
                    <div id="collapseTwo" class="collapse" role="tabpanel" aria-labelledby="headingTwo">
                      <div class="card-body">
                        Anim pariatur cliche reprehenderit, enim eiusmod high life accusamus terry richardson ad squid. 3 wolf moon officia aute, non cupidatat skateboard dolor brunch. Food truck quinoa nesciunt laborum eiusmod. Brunch 3 wolf moon tempor, sunt aliqua put a bird on it squid single-origin coffee nulla assumenda shoreditch et. Nihil anim keffiyeh helvetica, craft beer labore wes anderson cred nesciunt sapiente ea proident. Ad vegan excepteur butcher vice lomo. Leggings occaecat craft beer farm-to-table, raw denim aesthetic synth nesciunt you probably haven't heard of them accusamus labore sustainable VHS.
                      </div>
                    </div>
                  </div>
                  <div class="card">
                    <div class="card-header" role="tab" id="headingThree">
                      <h5 class="mb-0 mt-0">
                        <a class="collapsed text-dark" data-toggle="collapse" data-parent="#accordion" href="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                          {% trans 'network' %}
                        </a>
                      </h5>
                    </div>
                    <div id="collapseThree" class="collapse" role="tabpanel" aria-labelledby="headingThree">
                      <div class="card-body">
                        Anim pariatur cliche reprehenderit, enim eiusmod high life accusamus terry richardson ad squid. 3 wolf moon officia aute, non cupidatat skateboard dolor brunch. Food truck quinoa nesciunt laborum eiusmod. Brunch 3 wolf moon tempor, sunt aliqua put a bird on it squid single-origin coffee nulla assumenda shoreditch et. Nihil anim keffiyeh helvetica, craft beer labore wes anderson cred nesciunt sapiente ea proident. Ad vegan excepteur butcher vice lomo. Leggings occaecat craft beer farm-to-table, raw denim aesthetic synth nesciunt you probably haven't heard of them accusamus labore sustainable VHS.
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button id="userObjectPermsBtn" type="button" class="btn btn-primary">{% trans 'Save changes' %}</button>
          <button type="button" class="btn btn-secondary" data-dismiss="modal">{% trans 'Close' %}</button>
        </div>
      </div>
    </div>
  </div>  <!-- userObjectPermsModal -->

  <div class="modal fade" id="userGlobalPermsModal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">{% trans 'Update user global permissions' %}</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="row">
            <div class="col-12">
              {# render jstree #}
              <div id="userGlobalPermsTree">
                <ul>
                  {% for ct in perm_content_types %}
                    {# user by content_types #}
                    <li>{{ ct.name }}
                      <ul>
                        {% for perm_item in all_perms %}
                          {% if perm_item.content_type_id == ct.id %}
                            <li id="{{ perm_item.id }}" {% if perm_item.assigned %}data-jstree='{ "selected" : true, "opened" : true }'{% endif %}>{{ perm_item.codename }} ({{ perm_item.name }})</li>
                          {% endif %}
                        {% endfor %}
                      </ul>
                    </li>
                  {% endfor %}
                </ul>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button id="userGlobalPermsBtn" type="button" class="btn btn-primary">{% trans 'Save changes' %}</button>
          <button type="button" class="btn btn-secondary" data-dismiss="modal">{% trans 'Close' %}</button>
        </div>
      </div>
    </div>
  </div>  <!-- userGlobalPermsModal -->
{% endblock %}

{% block container %}
  <div class="row">
    <div class="col-lg-12">
      <div class="card-box" id="userDetailCardBox">
        <div class="dropdown pull-right">
          <a href="#" class="dropdown-toggle arrow-none card-drop" data-toggle="dropdown" aria-expanded="false">
            <i class="mdi mdi-dots-vertical"></i>
          </a>
          <div class="dropdown-menu dropdown-menu-right">
            <a href="javascript:void(0);" class="dropdown-item" data-toggle="modal" data-target="#userDetailUpdateModal">{% trans 'Update user' %}</a>
            <a href="javascript:void(0);" class="dropdown-item">Something else</a>
            <a href="javascript:void(0);" class="dropdown-item">Separated link</a>
          </div>
        </div>

        <h4 class="header-title m-t-0 m-b-30">{% trans 'User detail' %}</h4>

        <p class="text-muted font-13 m-b-25">
          {% blocktrans %}
            Welcome to user detail, please click top-right icon to discover more.
          {% endblocktrans %}
        </p>

        <p>{% trans 'username' %} <span>{{ user.username }}</span></p>
        <p>{% trans 'user' %} ID <span>{{ user.id }}</span></p>
        <p>{% trans 'active' %} <span>{% if user.is_active %}{% trans 'yes' %}{% else %}{% trans 'no' %}{% endif %}</span></p>
        <p id="userEmail">{% trans 'email' %} <span>{{ user.email }}</span></p>
      </div>  {# userDetailCardBox #}


      <div class="card-box" id="userObjectPermsCardBox">
        <div class="dropdown pull-right">
          <a href="#" class="dropdown-toggle arrow-none card-drop" data-toggle="dropdown" aria-expanded="false">
            <i class="mdi mdi-dots-vertical"></i>
          </a>
          <div class="dropdown-menu dropdown-menu-right">
            <a href="javascript:void(0);" class="dropdown-item" data-toggle="modal" data-target="#userObjectPermsModal">{% trans 'Update object permission' %}</a>
            <a href="javascript:void(0);" class="dropdown-item">Something else</a>
            <a href="javascript:void(0);" class="dropdown-item">Separated link</a>
          </div>
        </div>

        <h4 class="header-title m-t-0 m-b-30">{% trans 'User object permissions' %}</h4>

        <p class="text-muted font-13 m-b-25">
          {% blocktrans %}
            Welcome to user object permission, please click top-right icon to discover more.
          {% endblocktrans %}
        </p>

        {# table here, 对应modal可使用tabs来展示，列出各类资源（Content-Type）下所有对象，更改每个用户权限 #}

      </div>  {# userObjectPermsCardBox #}

      <div class="card-box" id="userGlobalPermsCardBox">
        <div class="dropdown pull-right">
          <a href="#" class="dropdown-toggle arrow-none card-drop" data-toggle="dropdown" aria-expanded="false">
            <i class="mdi mdi-dots-vertical"></i>
          </a>
          <div class="dropdown-menu dropdown-menu-right">
            <a href="javascript:void(0);" class="dropdown-item" data-toggle="modal" data-target="#userGlobalPermsModal">{% trans 'Update global permission' %}</a>
            <a href="javascript:void(0);" class="dropdown-item">Something else</a>
            <a href="javascript:void(0);" class="dropdown-item">Separated link</a>
          </div>
        </div>

        <h4 class="header-title m-t-0 m-b-30">{% trans 'User global permissions' %}</h4>

        <p class="text-muted font-13 m-b-25">
          {% blocktrans %}
            Welcome to user global permission, please click top-right icon to discover more.
          {% endblocktrans %}
        </p>

        <div class="table-responsive">
          <table class="table m-0">
            <thead>
            <tr>
              <th>{% trans 'Name' %}</th>
              <th>{% trans 'Content type' %}</th>
              <th>{% trans 'Code name' %}</th>
            </tr>
            </thead>
            <tbody>
            {% for p in user.user_permissions.all %}
              <tr>
                <td>{{ p.name }}</td>
                <td>{{ p.content_type }}</td>
                <td>{{ p.codename }}</td>
              </tr>
            {% endfor %}
            </tbody>
          </table>
        </div>
      </div>  {# userGlobalPermsCardBox #}

    </div><!-- end col -->

  </div>
{% endblock %}

{% block dashboard_js_head %}
  <script>
      {# django value to js #}
      var userGlobalPermsUrl = "{% url 'identity:user_permission_update' user.id %}";
      var userObjectPermsUrl = "";
  </script>
  <script src="{% static 'js/pages/identity/user.js' %}"></script>
  <script src="{% static 'plugins/jstree/jstree.min.js' %}"></script>
{% endblock %}